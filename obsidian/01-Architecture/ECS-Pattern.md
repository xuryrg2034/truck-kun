---
tags: [architecture, ecs, entitas]
aliases: [ECS, Entitas Pattern]
related: [[Contexts]], [[View-Binding]]
---

# Entitas ECS Pattern

Архитектура на базе Entitas ECS + Zenject + Unity.

## Стек

| Слой | Технология | Назначение |
|------|------------|------------|
| ECS | Entitas | Данные и логика |
| DI | Zenject | Внедрение зависимостей |
| Async | UniTask | Асинхронные операции |
| View | Unity MonoBehaviour | Визуальное представление |

## Архитектурные слои

```
┌─────────────────────────────────────────────────┐
│                 Game States                      │
│         (StateMachine, IState, IUpdateable)      │
├─────────────────────────────────────────────────┤
│                   Features                       │
│            (композиция систем)                   │
├─────────────────────────────────────────────────┤
│                   Systems                        │
│    (IInitialize, IExecute, ICleanup, Reactive)   │
├─────────────────────────────────────────────────┤
│                 Components                       │
│           (данные без логики)                    │
├─────────────────────────────────────────────────┤
│                  Entities                        │
│          (контейнеры компонентов)                │
├─────────────────────────────────────────────────┤
│                  Contexts                        │
│     (Game, Input, Meta — или свои контексты)     │
└─────────────────────────────────────────────────┘
```

## Типы систем

| Интерфейс | Когда | Применение |
|-----------|-------|------------|
| `IInitializeSystem` | Один раз | Создание начальных сущностей |
| `IExecuteSystem` | Каждый кадр | Основная логика |
| `ICleanupSystem` | После Execute | Удаление временных компонентов |
| `ReactiveSystem<T>` | При изменении | Реакция на события |

## Ключевые правила

### DO

- Разделяй данные (компоненты) и логику (системы)
- Используй фабрики для создания сущностей
- Фильтруй `.NoneOf(Destructed)` в системах
- Получай зависимости через конструктор
- Используй индексы для связей

### DON'T

- Не пиши логику в компонентах
- Не создавай сущности напрямую через `context.CreateEntity()`
- Не храни ссылки на сущности — используй Id
- Не модифицируй коллекцию во время итерации
- Не пиши бизнес-логику в MonoBehaviour

## Связанное

- [[Contexts]] — разделение по доменам
- [[View-Binding]] — связь ECS с Unity
- [[Home]] — навигация по проекту
